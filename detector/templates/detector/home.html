<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>AgriVision</title>
	{% load static %}
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'css/styles.css' %}">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
		<div class="container">
			<a class="navbar-brand fw-bold" href="#">AgriVision</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navCollapse" aria-controls="navCollapse" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navCollapse">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item"><a class="nav-link" href="#">Home</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<main class="py-5">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-md-8">
					<div class="card shadow-sm border-0 overflow-hidden">
						<div class="row g-0">
							<div class="col-md-6 d-flex align-items-center p-4 bg-light">
								<div>
									<h2 class="h4 mb-2">CropDetect</h2>
									<p class="text-muted mb-4">Upload a leaf image and our model will detect crop disease and suggest next steps.</p>
									<form method="post" enctype="multipart/form-data" id="detect-form">
										{% csrf_token %}
										<div class="mb-3">
											{{ form.as_p }}
										</div>
										<div class="d-flex gap-2">
											<button type="submit" class="btn btn-primary btn-lg">Detect Disease</button>
											<button type="reset" class="btn btn-outline-secondary btn-lg" id="reset-btn">Reset</button>
										</div>
									</form>
								</div>
							</div>
							<div class="col-md-6 p-3 d-flex flex-column align-items-center justify-content-center">
								<div class="preview-wrap text-center">
									<img id="img-preview" src="{% static 'images/placeholder-leaf.png' %}" alt="preview" class="img-fluid rounded shadow-sm preview-img">
									<p class="small text-muted mt-2">Preview of selected image</p>
								</div>
							</div>
						</div>
					</div>
					<div class="text-center mt-3 text-muted small">Tip: Use clear, close-up images of the affected leaf for best results.</div>
				</div>
			</div>
		</div>
	</main>

	<footer class="py-4 bg-white border-top">
		<div class="container text-center text-muted">Â© {{ now|date:"Y" }} AgriVision</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// Image preview for file input (works if the form has a file input named 'image' or similar)
		document.addEventListener('DOMContentLoaded', function () {
			const form = document.getElementById('detect-form');
			const preview = document.getElementById('img-preview');
			const resetBtn = document.getElementById('reset-btn');

			// try to find file input in the form
			const fileInput = form ? form.querySelector('input[type=file]') : null;
			if (fileInput) {
				fileInput.addEventListener('change', function (e) {
					const file = e.target.files && e.target.files[0];
					if (!file) return;
					const reader = new FileReader();
					reader.onload = function (ev) {
						preview.src = ev.target.result;
					};
					reader.readAsDataURL(file);
				});
			}

			if (resetBtn) {
				resetBtn.addEventListener('click', function () {
					// reset preview to placeholder if available
					preview.src = '{% static "images/placeholder-leaf.png" %}';
				});
			}
		});
	</script>
</body>
</html>